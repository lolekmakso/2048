const t=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this._initialState=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this._state=t,this._status="idle",this._score=0}moveLeft(){if("playing"!==this._status)return[];let t=[...this._state],e=[];for(let s=0;s<t.length;s++){let o=[],r=t[s].filter((t,e)=>(0!==t&&o.push({fromRow:s,fromCol:e}),0!==t));o.forEach((t,e)=>{t.toRow=s,t.toCol=e,t.isMoved=t.toCol!==t.fromCol}),r=[...r,...Array(t[s].length-r.length).fill(0)];for(let t=0;t<r.length-1;t++)r[t]===r[t+1]&&0!==r[t]&&(r[t]+=r[t+1],this._score+=r[t],r.splice(t+1,1),r.push(0),o.forEach(e=>{e.toCol===t?(e.toCol=t,e.isMerged=!0,e.isMoved=e.fromCol!==t):e.toCol===t+1&&(e.toCol=t+1,e.isMerged=!0,e.isMoved=!0),e.toCol>t+1&&(e.toCol-=1)}));e.push(...o),t[s]=r}return this._state=t,e.some(t=>t.isMoved||t.isMerged)&&(this.spawnNumber(),this.updateStatus()),e}moveRight(){if("playing"!==this._status)return[];let t=[...this._state],e=[];for(let s=0;s<t.length;s++){let o=[],r=t[s].filter((t,e)=>(0!==t&&o.push({fromRow:s,fromCol:e}),0!==t));o.forEach((e,o)=>{e.toRow=s,e.toCol=t[s].length-r.length+o,e.isMoved=e.toCol!==e.fromCol}),r=[...Array(t[s].length-r.length).fill(0),...r];for(let t=r.length-1;t>0;t--)r[t]===r[t-1]&&0!==r[t]&&(r[t]+=r[t-1],this._score+=r[t],r.splice(t-1,1),r.unshift(0),o.forEach(e=>{e.toCol===t?(e.toCol=t,e.isMerged=!0):e.toCol===t-1&&(e.toCol=t-1,e.isMerged=!0,e.isMoved=!0),e.toCol<t-1&&(e.toCol+=1)}));e.push(...o),t[s]=r}return this._state=t,e.some(t=>t.isMoved||t.isMerged)&&(this.spawnNumber(),this.updateStatus()),e}moveUp(){if("playing"!==this._status)return[];let t=[...this._state],e=[];for(let s=0;s<t[0].length;s++){let o=[],r=[];for(let e=0;e<t.length;e++)0!==t[e][s]&&(o.push(t[e][s]),r.push({fromRow:e,fromCol:s}));r.forEach((t,e)=>{t.toRow=e,t.toCol=s,t.isMoved=t.toRow!==t.fromRow}),o=[...o,...Array(t.length-o.length).fill(0)];for(let t=0;t<o.length;t++)o[t]===o[t+1]&&0!==o[t]&&(o[t]+=o[t+1],this._score+=o[t],o.splice(t+1,1),o.push(0),r.forEach(e=>{e.toRow===t?(e.toRow=t,e.isMerged=!0):e.toRow===t+1&&(e.toRow=t+1,e.isMerged=!0,e.isMoved=!0),e.toRow>t+1&&(e.toRow-=1)}));for(let e=0;e<t.length;e++)t[e][s]=o[e];e.push(...r)}return this._state=t,e.some(t=>t.isMoved||t.isMerged)&&(this.spawnNumber(),this.updateStatus()),e}moveDown(){if("playing"!==this._status)return[];let t=[...this._state],e=[];for(let s=0;s<t[0].length;s++){let o=[],r=[];for(let e=0;e<t.length;e++)0!==t[e][s]&&(o.push(t[e][s]),r.push({fromRow:e,fromCol:s}));r.forEach((e,r)=>{e.toRow=t.length-o.length+r,e.toCol=s,e.isMoved=e.toRow!==e.fromRow}),o=[...Array(t.length-o.length).fill(0),...o];for(let t=o.length-1;t>0;t--)o[t]===o[t-1]&&0!==o[t]&&(o[t]+=o[t-1],this._score+=o[t],o.splice(t-1,1),o.unshift(0),r.forEach(e=>{e.toRow===t?(e.toRow=t,e.isMerged=!0):e.toRow===t-1&&(e.toRow=t-1,e.isMerged=!0,e.isMoved=!0),e.toRow<t-1&&(e.toRow+=1)}));for(let e=0;e<t.length;e++)t[e][s]=o[e];e.push(...r)}return this._state=t,e.some(t=>t.isMoved||t.isMerged)&&(this.spawnNumber(),this.updateStatus()),e}getScore(){return this._score}getState(){return structuredClone(this._state)}updateStatus(){this.isWin()?this._status="win":this.canMove()||(this._status="lose")}getStatus(){return this._status}start(){"idle"===this._status&&(this._status="playing",this.spawnNumber(),this.spawnNumber(),this._score=0)}reset(){this._state=structuredClone(this._initialState),this._score=0,this._status="idle"}restart(){this.reset()}spawnNumber(){let t=[];if(!this._state.some(t=>t.includes(0)))return!1;for(let e=0;e<this._state.length;e++)for(let s=0;s<this._state[e].length;s++)0===this._state[e][s]&&t.push({x:s,y:e});let e=Math.floor(Math.random()*t.length),s=t[e].x,o=t[e].y,r=100*Math.random();return this._state[o][s]=r<=10?4:2,!0}isWin(){return this._state.some(t=>t.includes(2048))}canMove(){if(this._state.some(t=>t.includes(0)))return!0;for(let t=0;t<4;t++)for(let e=0;e<4;e++){let s=this._state[t][e];if(t<3&&s===this._state[t+1][e]||e<3&&s===this._state[t][e+1])return!0}return!1}},e=document.querySelector(".game-field"),s=document.querySelector(".button"),o=document.querySelector(".message-start"),r=document.querySelector(".message-lose"),i=document.querySelector(".message-win"),l=document.querySelector(".game-score");let a=!0;function n(s,o){l.textContent=t.getScore();for(let t=0;t<o.length;t++)for(let l=0;l<o[t].length;l++){var r,i;let a=(r=t,i=l,e.querySelectorAll(".field-row")[r].querySelectorAll(".field-cell")[i]);a.className="field-cell",a.textContent="",0!==o[t][l]&&(s[t][l]!==o[t][l]&&a.classList.add("field-cell--animation"),a.classList.add("field-cell--"+o[t][l]),a.textContent=o[t][l].toString())}}s.addEventListener("click",function(e){s.classList.contains("start")&&("idle"===t.getStatus()&&(a=!1,function(){let e=t.getState();t.start(),n(e,t.getState())}(),o.classList.add("hidden")),s.blur()),s.classList.contains("restart")&&function(){let e=t.getState();t.restart(),n(e,t.getState()),s.textContent="Start",s.classList.remove("restart"),s.classList.add("start"),o.classList.remove("hidden"),r.classList.add("hidden"),i.classList.add("hidden"),s.blur()}()}),document.addEventListener("keydown",function(e){if(a)return;let o=t.getState();switch("ArrowLeft"===e.key&&t.moveLeft(),"ArrowRight"===e.key&&t.moveRight(),"ArrowUp"===e.key&&t.moveUp(),"ArrowDown"===e.key&&t.moveDown(),n(o,t.getState()),t.getStatus()){case"playing":a=!1,s.textContent="Restart",s.classList.remove("start"),s.classList.add("restart");break;case"win":i.classList.remove("hidden"),a=!0;break;case"lose":r.classList.remove("hidden"),a=!0;break;case"idle":a=!0}});
//# sourceMappingURL=index.4e25aa9f.js.map
