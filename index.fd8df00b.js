!function(){function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,r=Array(e);o<e;o++)r[o]=t[o];return r}function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(e,o){if(e){if("string"==typeof e)return t(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,void 0)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var o=new/*#__PURE__*/(function(){var t;function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,o),this._initialState=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this._state=t,this._status="idle",this._score=0}return t=[{key:"moveLeft",value:function(){var t=this,o=function(o){var s=function(e){a[e]===a[e+1]&&0!==a[e]&&(a[e]+=a[e+1],t._score+=a[e],a.splice(e+1,1),a.push(0),i.forEach(function(t){t.toCol===e?(t.toCol=e,t.isMerged=!0,t.isMoved=t.fromCol!==e):t.toCol===e+1&&(t.toCol=e+1,t.isMerged=!0,t.isMoved=!0),t.toCol>e+1&&(t.toCol-=1)}))},i=[],a=r[o].filter(function(t,e){return 0!==t&&i.push({fromRow:o,fromCol:e}),0!==t});i.forEach(function(t,e){t.toRow=o,t.toCol=e,t.isMoved=t.toCol!==t.fromCol}),a=e(a).concat(e(Array(r[o].length-a.length).fill(0)));for(var u=0;u<a.length-1;u++)s(u);n.push.apply(n,e(i)),r[o]=a};if("playing"!==this._status)return[];for(var r=e(this._state),n=[],s=0;s<r.length;s++)o(s);return this._state=r,n.some(function(t){return t.isMoved||t.isMerged})&&(this.spawnNumber(),this.updateStatus()),n}},{key:"moveRight",value:function(){var t=this,o=function(o){var s=function(e){a[e]===a[e-1]&&0!==a[e]&&(a[e]+=a[e-1],t._score+=a[e],a.splice(e-1,1),a.unshift(0),i.forEach(function(t){t.toCol===e?(t.toCol=e,t.isMerged=!0):t.toCol===e-1&&(t.toCol=e-1,t.isMerged=!0,t.isMoved=!0),t.toCol<e-1&&(t.toCol+=1)}))},i=[],a=r[o].filter(function(t,e){return 0!==t&&i.push({fromRow:o,fromCol:e}),0!==t});i.forEach(function(t,e){t.toRow=o,t.toCol=r[o].length-a.length+e,t.isMoved=t.toCol!==t.fromCol}),a=e(Array(r[o].length-a.length).fill(0)).concat(e(a));for(var u=a.length-1;u>0;u--)s(u);n.push.apply(n,e(i)),r[o]=a};if("playing"!==this._status)return[];for(var r=e(this._state),n=[],s=0;s<r.length;s++)o(s);return this._state=r,n.some(function(t){return t.isMoved||t.isMerged})&&(this.spawnNumber(),this.updateStatus()),n}},{key:"moveUp",value:function(){var t=this,o=function(o){for(var s=function(e){i[e]===i[e+1]&&0!==i[e]&&(i[e]+=i[e+1],t._score+=i[e],i.splice(e+1,1),i.push(0),a.forEach(function(t){t.toRow===e?(t.toRow=e,t.isMerged=!0):t.toRow===e+1&&(t.toRow=e+1,t.isMerged=!0,t.isMoved=!0),t.toRow>e+1&&(t.toRow-=1)}))},i=[],a=[],u=0;u<r.length;u++)0!==r[u][o]&&(i.push(r[u][o]),a.push({fromRow:u,fromCol:o}));a.forEach(function(t,e){t.toRow=e,t.toCol=o,t.isMoved=t.toRow!==t.fromRow}),i=e(i).concat(e(Array(r.length-i.length).fill(0)));for(var l=0;l<i.length;l++)s(l);for(var c=0;c<r.length;c++)r[c][o]=i[c];n.push.apply(n,e(a))};if("playing"!==this._status)return[];for(var r=e(this._state),n=[],s=0;s<r[0].length;s++)o(s);return this._state=r,n.some(function(t){return t.isMoved||t.isMerged})&&(this.spawnNumber(),this.updateStatus()),n}},{key:"moveDown",value:function(){var t=this,o=function(o){for(var s=function(e){i[e]===i[e-1]&&0!==i[e]&&(i[e]+=i[e-1],t._score+=i[e],i.splice(e-1,1),i.unshift(0),a.forEach(function(t){t.toRow===e?(t.toRow=e,t.isMerged=!0):t.toRow===e-1&&(t.toRow=e-1,t.isMerged=!0,t.isMoved=!0),t.toRow<e-1&&(t.toRow+=1)}))},i=[],a=[],u=0;u<r.length;u++)0!==r[u][o]&&(i.push(r[u][o]),a.push({fromRow:u,fromCol:o}));a.forEach(function(t,e){t.toRow=r.length-i.length+e,t.toCol=o,t.isMoved=t.toRow!==t.fromRow}),i=e(Array(r.length-i.length).fill(0)).concat(e(i));for(var l=i.length-1;l>0;l--)s(l);for(var c=0;c<r.length;c++)r[c][o]=i[c];n.push.apply(n,e(a))};if("playing"!==this._status)return[];for(var r=e(this._state),n=[],s=0;s<r[0].length;s++)o(s);return this._state=r,n.some(function(t){return t.isMoved||t.isMerged})&&(this.spawnNumber(),this.updateStatus()),n}},{key:"getScore",value:function(){return this._score}},{key:"getState",value:function(){return structuredClone(this._state)}},{key:"updateStatus",value:function(){this.isWin()?this._status="win":this.canMove()||(this._status="lose")}},{key:"getStatus",value:function(){return this._status}},{key:"start",value:function(){"idle"===this._status&&(this._status="playing",this.spawnNumber(),this.spawnNumber(),this._score=0)}},{key:"reset",value:function(){this._state=structuredClone(this._initialState),this._score=0,this._status="idle"}},{key:"restart",value:function(){this.reset()}},{key:"spawnNumber",value:function(){var t=[];if(!this._state.some(function(t){return t.includes(0)}))return!1;for(var e=0;e<this._state.length;e++)for(var o=0;o<this._state[e].length;o++)0===this._state[e][o]&&t.push({x:o,y:e});var r=Math.floor(Math.random()*t.length),n=t[r].x,s=t[r].y,i=100*Math.random();return this._state[s][n]=i<=10?4:2,!0}},{key:"isWin",value:function(){return this._state.some(function(t){return t.includes(2048)})}},{key:"canMove",value:function(){if(this._state.some(function(t){return t.includes(0)}))return!0;for(var t=0;t<4;t++)for(var e=0;e<4;e++){var o=this._state[t][e];if(t<3&&o===this._state[t+1][e]||e<3&&o===this._state[t][e+1])return!0}return!1}}],function(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(o.prototype,t),o}()),r=document.querySelector(".game-field"),n=document.querySelector(".button"),s=document.querySelector(".message-start"),i=document.querySelector(".message-lose"),a=document.querySelector(".message-win"),u=document.querySelector(".game-score"),l=!0;function c(t,e){u.textContent=o.getScore();for(var n=0;n<e.length;n++)for(var s=0;s<e[n].length;s++){var i,a,l=(i=n,a=s,r.querySelectorAll(".field-row")[i].querySelectorAll(".field-cell")[a]);l.className="field-cell",l.textContent="",0!==e[n][s]&&(t[n][s]!==e[n][s]&&l.classList.add("field-cell--animation"),l.classList.add("field-cell--"+e[n][s]),l.textContent=e[n][s].toString())}}n.addEventListener("click",function(t){var e,r;n.classList.contains("start")&&("idle"===o.getStatus()&&(l=!1,e=o.getState(),o.start(),c(e,o.getState()),s.classList.add("hidden")),n.blur()),n.classList.contains("restart")&&(r=o.getState(),o.restart(),c(r,o.getState()),n.textContent="Start",n.classList.remove("restart"),n.classList.add("start"),s.classList.remove("hidden"),i.classList.add("hidden"),a.classList.add("hidden"),n.blur())}),document.addEventListener("keydown",function(t){if(!l){var e=o.getState();switch("ArrowLeft"===t.key&&o.moveLeft(),"ArrowRight"===t.key&&o.moveRight(),"ArrowUp"===t.key&&o.moveUp(),"ArrowDown"===t.key&&o.moveDown(),c(e,o.getState()),o.getStatus()){case"playing":l=!1,n.textContent="Restart",n.classList.remove("start"),n.classList.add("restart");break;case"win":a.classList.remove("hidden"),l=!0;break;case"lose":i.classList.remove("hidden"),l=!0;break;case"idle":l=!0}}})}();
//# sourceMappingURL=index.fd8df00b.js.map
